{% extends "base.html" %}
{% block content %}
<style>
    .chat-wrapper {
        display: flex; flex-direction: column; height: 100vh;
    }
    .chat-header {
        padding: 10px 15px; background: var(--bg-panel); border-bottom: 1px solid #000;
        display: flex; align-items: center; gap: 15px;
    }
    #chatBox {
        flex: 1; overflow-y: auto; padding: 15px;
        display: flex; flex-direction: column; gap: 10px;
        background: var(--bg-main);
    }
    .msg {
        padding: 8px 12px; border-radius: 12px; color: white;
        max-width: 80%; word-wrap: break-word; font-size: 0.95rem;
    }
    .sent { align-self: flex-end; background: var(--accent); border-bottom-right-radius: 2px; }
    .received { align-self: flex-start; background: #2b3948; border-bottom-left-radius: 2px; }
    .time { font-size: 0.6rem; opacity: 0.6; text-align: right; margin-top: 3px; }

    .input-form {
        padding: 15px; background: var(--bg-panel);
        display: flex; gap: 10px; border-top: 1px solid #000;
    }
    #msgInput { flex: 1; margin: 0; }
    .send-btn { width: auto; padding: 0 20px; margin: 0; }
</style>

<div class="chat-wrapper">
    <div class="chat-header">
        <a href="{{ url_for('index') }}" style="color: var(--accent); text-decoration: none;">←</a>
        <div style="font-weight: bold;">{{ recipient.username }}</div>
    </div>

    <div id="chatBox">
        {% for msg in messages %}
            <div class="msg {% if msg.sender_id == current_user.id %}sent{% else %}received{% endif %}">
                {{ msg.body }}
                <div class="time">{{ msg.timestamp.strftime('%H:%M') }}</div>
            </div>
        {% endfor %}
    </div>

    <form class="input-form" method="POST">
        <input type="text" name="message" id="msgInput" placeholder="Сообщение..." required autocomplete="off" autofocus>
        <button type="submit" class="send-btn">➤</button>
    </form>
</div>

<script>
    // Автоскролл вниз при загрузке страницы
    window.onload = function() {
        var chatBox = document.getElementById("chatBox");
        chatBox.scrollTop = chatBox.scrollHeight;
    };
</script>
{% endblock %}
